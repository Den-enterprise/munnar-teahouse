<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Munnar Tea House - Where The Fresh Tea Originate</title>
  <!-- Bootstrap CSS -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Open+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- Javascript Files -->
  <script src="scripts/script.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<!-- Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

<!-- Bootstrap 4 JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- style sheet-->
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>

  <!-- ============== NAV BAR ============= -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-3 position-relative">
    <div class="container">

      <a class="navbar-brand text-success" href="#"><img src="images/logo.png" style="width: 45px;"/></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item me-5"><a class="nav-link text-dark" href="index.html">Home</a></li>
          <li class="nav-item me-5"><a class="nav-link text-dark" href="index.html#About">About Us</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="our-products.html">Our Products</a></li>
        </ul>
      </div>
      <!-- Cart button in navbar (opens cart panel) -->
      <div class="d-flex align-items-center ms-auto">
        <button id="navbarCartBtn" class="btn btn-outline-success btn-sm navbar-cart-btn" aria-label="Open cart">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <path d="M6 6H21L20 14H8L6 6Z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round"/>
            <circle cx="10" cy="19" r="1.4" fill="currentColor"/>
            <circle cx="18" cy="19" r="1.4" fill="currentColor"/>
          </svg>
          <span class="ms-1">Cart</span> (<span id="navbarCartCount">0</span>)
        </button>
      </div>
    </div>
  </nav>

<!--================== Our Product Banner ======================= -->
<!--================== Our Product Banner ======================= -->
  <section class="our-products-hero text-center text-white d-flex align-items-center">
    <div class="container">
      <h2 class="display-5 fw-semibold mb-2">Our Products</h2>
      <p class="lead">Handpicked flavors, packed with care and tradition</p>
    </div>
  </section>
  <!-- ================== Products Listing ==================================== -->
  <!-- Product Section -->

<div class="row">
            <div class="col-md-3">
                <div class="filter-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">Filters</h4>
                        <button id="clearFilters" class="btn btn-sm btn-outline-secondary">Clear All</button>
                    </div>
                    
                    <!-- Category Filter -->
                    <div class="filter-group">
                        <div class="filter-title">Category</div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-tea" class="category-filter" value="tea">
                            <label for="filter-tea">Tea</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-spices" class="category-filter" value="spices">
                            <label for="filter-spices">Spices</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-nuts" class="category-filter" value="nuts">
                            <label for="filter-nuts">Nuts</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-other" class="category-filter" value="other">
                            <label for="filter-other">Other Savouries</label>
                        </div>
                    </div>
                    
                    <!-- Price Filter -->
                    <div class="filter-group">
                        <div class="filter-title">Price Range</div>
                        <div class="price-inputs mb-2">
                            <input type="number" id="minPrice" class="form-control form-control-sm" placeholder="Min" min="0">
                            <input type="number" id="maxPrice" class="form-control form-control-sm" placeholder="Max" min="0">
                        </div>
                        <button id="applyPrice" class="btn btn-sm btn-success">Apply Price Filter</button>
                    </div>
                    
                    <!-- Active Filters Display -->
                    <div id="activeFilters" class="mt-3">
                        <div class="filter-title">Active Filters</div>
                        <div id="filterTags" class="d-flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>
            
            <!-- Products Section -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <span id="productCount" class="text-muted">Showing all products</span>
                    </div>
                    <div>
                        <select id="sortBy" class="form-select form-select-sm">
                            <option value="default">Sort by</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name: A to Z</option>
                        </select>
                    </div>
                </div>
                
  <section class="py-4">
    <div class="container">
      <main class="shop-page-container">

    <section class="product-division">
        <div class="category-header">
            <h2>Tea</h2>
            <div class="divider-bar"></div>
        </div>
        <div class="product-grid">
            </div>
    </section>
      <!-- Product Grid -->
      <div class="row g-4" id="productGrid">

        <!-- Product Card: Spicefullness -->
        <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\1.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">BOP Tea - Whole Leaf</h5>
              <p class="text-muted small">Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹246 <span class="text-muted">/ pack</span></p>
              <a href="https://munnar-tea-house.mini.site/products/4b33fc9c-ff1b-45ee-a894-04063650da00?slug=munnar-tea-house"><button class="btn btn-success btn-sm">Add to cart</button></a>
            </div>
          </div>
        </div>

                <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\8.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Masala Tea</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\9.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Ginger Tea</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\10.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Cinnamon Tea</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\11.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Cardamom Tea</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 col-xs-6 col-sm-3 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\12.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Chocolate Tea</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

            <section class="product-division">
        <div class="category-header">
            <h2>Spices</h2>
            <div class="divider-bar"></div>
        </div>
        <div class="product-grid">
            </div>
    </section>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\2.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Kuzhumuzhagu</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\3.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Elakkai</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\4.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Cloves</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\14.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Kudampuli</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\13.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Cinnamon sticks</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

            <section class="product-division">
        <div class="category-header">
            <h2>Nuts</h2>
            <div class="divider-bar"></div>
        </div>
        <div class="product-grid">
            </div>
    </section>

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\6.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Almonds</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        


        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\7.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Dates</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>


        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\5.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Cashew</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

 

        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\15.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Badam</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>


    <section class="product-division">
        <div class="category-header">
            <h2>Other Savouries</h2>
            <div class="divider-bar"></div>
        </div>
        <div class="product-grid">
            </div>
    </section>

        <!-- Product Card: Ripple -->
        <div class="col-md-2 product-card" data-category="ripple">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\16.webp" class="card-img-top" alt="Ripple">
            <div class="card-body text-center">
              <h5 class="card-title">Lemongrass oil</h5>
              <p class="text-muted small">Green Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹1,311 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>

        <!-- Product Card: Spicefullness -->
        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\17.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Achaar</h5>
              <p class="text-muted small">Black Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>


        <div class="col-md-2 product-card" data-category="spicefullness">
          <div class="card h-100 shadow-sm border-0">
            <img src="images\products\19.webp" class="card-img-top" alt="Spicefullness">
            <div class="card-body text-center">
              <h5 class="card-title">Strawberry preserve</h5>
              <p class="text-muted small">Matcha Tea Powder</p>
              <div class="text-warning mb-2">★★★★☆ <span class="text-muted small">4.5</span></div>
              <p class="fw-semibold">₹2,459 <span class="text-muted">/ kg</span></p>
              <button class="btn btn-success btn-sm">Add to cart</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


<div class="modal fade" id="quickViewModal" tabindex="-1" role="dialog" aria-labelledby="quickViewLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title font-weight-bold text-dark" id="quickViewLabel">Product Name</h5>
        <button type="button" class="close" aria-label="Close" id="quickViewClose">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="row align-items-center">
          <div class="col-md-5 text-center mb-3">
            <img id="quickViewImage" src="" alt="Product Image" class="img-fluid rounded shadow-sm">
          </div>
          <div class="col-md-7">
            <h4 id="quickViewPrice" class="text-success mb-3"></h4>
            <p id="quickViewDescription" class="text-muted">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla at commodo nulla, vel imperdiet nisi.
            </p>
            <div class="d-flex align-items-center my-3">
              <label for="quickViewQuantity" class="mr-2 mb-0 text-dark">Quantity:</label>
              <input type="number" id="quickViewQuantity" class="form-control w-25" value="1" min="1">
            </div>
            <button id="addToCartButton" class="btn btn-success px-4">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Example: Replace with Instagram Graph API or a fetch from your backend
  (function(){
    const posts = [
      "https://via.placeholder.com/400x400?text=Post+1",
      "https://via.placeholder.com/400x400?text=Post+2",
      "https://via.placeholder.com/400x400?text=Post+3",
      "https://via.placeholder.com/400x400?text=Post+4",
      "https://via.placeholder.com/400x400?text=Post+5",
      "https://via.placeholder.com/400x400?text=Post+6"
    ];

    const feedContainer = document.getElementById("insta-feed");
    if (feedContainer) {
      posts.forEach(url => {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-2 col-md-3";
        col.innerHTML = `
          <div class="card border-0 shadow-sm">
            <img src="${url}" class="card-img-top" alt="Instagram post">
          </div>
        `;
        feedContainer.appendChild(col);
      });
    }
  })();

  // ===== QUICK VIEW + FILTERS =====
  document.addEventListener('DOMContentLoaded', function() {
    // Quick view handlers
    document.querySelectorAll('.product-card .card').forEach(card => {
      card.addEventListener('click', function (event) {
        if (event.target.closest('button')) return; // don't open when clicking buttons

        const imageEl = this.querySelector('.card-img-top');
        const nameEl = this.querySelector('.card-title');
        const priceEl = this.querySelector('.fw-semibold');
        if (!imageEl || !nameEl || !priceEl) return;

        document.getElementById('quickViewImage').src = imageEl.src;
        document.getElementById('quickViewLabel').innerText = nameEl.textContent.trim();
        document.getElementById('quickViewPrice').innerText = priceEl.innerText;
        document.getElementById('quickViewQuantity').value = 1;

        // Using jQuery/Bootstrap 4 modal API if available
        if (typeof $ !== 'undefined' && $.fn && $.fn.modal) {
          $('#quickViewModal').modal('show');
        } else {
          // Basic fallback
          const modal = document.getElementById('quickViewModal');
          modal.classList.add('show');
          modal.style.display = 'block';
          document.body.classList.add('modal-open');
        }
      });
    });

    // Close button
    const closeBtn = document.getElementById('quickViewClose');
    if (closeBtn) closeBtn.addEventListener('click', function(){
      const modal = document.getElementById('quickViewModal');
      if (typeof $ !== 'undefined' && $.fn && $.fn.modal) {
        $(modal).modal('hide');
      } else {
        modal.classList.remove('show');
        modal.style.display = 'none';
        document.body.classList.remove('modal-open');
        const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.remove();
      }
    });

    document.getElementById('addToCartButton')?.addEventListener('click', function(){
      const name = document.getElementById('quickViewLabel').innerText;
      const qty = document.getElementById('quickViewQuantity').value;
      alert(`${qty} × ${name} added to cart.`);
      if (typeof $ !== 'undefined' && $.fn && $.fn.modal) $('#quickViewModal').modal('hide');
    });

    // Product data with categories and prices
    const products = [
      { id: 1, name: "BOP Tea - Whole Leaf", category: "tea", price: 246, element: null },
      { id: 2, name: "Masala Tea", category: "tea", price: 2459, element: null },
      { id: 3, name: "Ginger Tea", category: "tea", price: 2459, element: null },
      { id: 4, name: "Cinnamon Tea", category: "tea", price: 2459, element: null },
      { id: 5, name: "Cardamom Tea", category: "tea", price: 2459, element: null },
      { id: 6, name: "Chocolate Tea", category: "tea", price: 2459, element: null },
      { id: 7, name: "Kuzhumuzhagu", category: "spices", price: 2459, element: null },
      { id: 8, name: "Elakkai", category: "spices", price: 2459, element: null },
      { id: 9, name: "Cloves", category: "spices", price: 2459, element: null },
      { id: 10, name: "Kudampuli", category: "spices", price: 2459, element: null },
      { id: 11, name: "Cinnamon sticks", category: "spices", price: 2459, element: null },
      { id: 12, name: "Almonds", category: "nuts", price: 2459, element: null },
      { id: 13, name: "Dates", category: "nuts", price: 2459, element: null },
      { id: 14, name: "Cashew", category: "nuts", price: 2459, element: null },
      { id: 15, name: "Badam", category: "nuts", price: 2459, element: null },
      { id: 16, name: "Lemongrass oil", category: "other", price: 1311, element: null },
      { id: 17, name: "Achaar", category: "other", price: 2459, element: null },
      { id: 18, name: "Strawberry preserve", category: "other", price: 2459, element: null }
    ];

    // Shared helpers --------------------------------------------------
    function normalizeCategoryKey(raw) {
      if (!raw) return null;
      const s = raw.toString().toLowerCase();
      if (s.includes('tea')) return 'tea';
      if (s.includes('spice')) return 'spices';
      if (s.includes('nut') || s.includes('almond') || s.includes('cashew') || s.includes('badam') || s.includes('date')) return 'nuts';
      if (s.includes('other') || s.includes('savour') || s.includes('ripple') || s.includes('lemongrass') || s.includes('achar') || s.includes('preserve')) return 'other';
      return null;
    }

    function getCardCategory(cardEl) {
      // Prefer data-category, then try to normalize from title or existing attribute
      const attr = (cardEl.getAttribute('data-category') || '').toLowerCase();
      const normalized = normalizeCategoryKey(attr);
      if (normalized) return normalized;
      const title = cardEl.querySelector('.card-title')?.textContent || '';
      const fromTitle = normalizeCategoryKey(title);
      if (fromTitle) return fromTitle;
      // As last resort, try to inspect small description text
      const meta = cardEl.querySelector('.text-muted')?.textContent || '';
      return normalizeCategoryKey(meta) || null;
    }

    function getCardPrice(cardEl) {
      const attr = cardEl.getAttribute('data-price');
      if (attr && !isNaN(parseInt(attr,10))) return parseInt(attr,10);
      const priceText = cardEl.querySelector('.fw-semibold')?.textContent || '';
      const numeric = priceText.replace(/[,₹\s]/g, '').match(/(\d+)/);
      return numeric ? parseInt(numeric[1], 10) : 0;
    }

    // Initialize product elements by normalizing attributes for all DOM cards
    function initializeProductElements() {
      const productElements = document.querySelectorAll('.product-card');
      productElements.forEach((el, idx) => {
        // Always record original DOM order for reliable "default" sorting
        el.setAttribute('data-original-order', idx);

        // If a matching product exists, set canonical attributes
        const title = el.querySelector('.card-title')?.textContent.trim();
        const product = products.find(p => p.name === title);
        if (product) {
          product.element = el;
          el.setAttribute('data-category', product.category);
          el.setAttribute('data-price', product.price);
          el.setAttribute('data-id', product.id);
        } else {
          // Normalize whatever data-category already exists (e.g., "spicefullness")
          const rawCat = el.getAttribute('data-category') || '';
          const norm = normalizeCategoryKey(rawCat) || normalizeCategoryKey(title) || normalizeCategoryKey(el.querySelector('.text-muted')?.textContent || '');
          if (norm) el.setAttribute('data-category', norm);
          // Ensure a data-price exists
          const priceVal = getCardPrice(el);
          el.setAttribute('data-price', priceVal);
        }
      });
    }

    // Filter state
    let activeFilters = { categories: [], minPrice: null, maxPrice: null };

    // DOM Elements
    const categoryFilters = document.querySelectorAll('.category-filter');
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    const applyPriceBtn = document.getElementById('applyPrice');
    const clearFiltersBtn = document.getElementById('clearFilters');
    const sortSelect = document.getElementById('sortBy');
    const productCount = document.getElementById('productCount');
    const filterTags = document.getElementById('filterTags');

    initializeProductElements();
    applyFilters();

    categoryFilters.forEach(filter => filter.addEventListener('change', handleCategoryFilter));
    applyPriceBtn?.addEventListener('click', handlePriceFilter);
    clearFiltersBtn?.addEventListener('click', clearAllFilters);
    sortSelect?.addEventListener('change', handleSort);

    function handleCategoryFilter() {
      activeFilters.categories = Array.from(categoryFilters).filter(f => f.checked).map(f => f.value);
      applyFilters(); updateFilterTags();
    }

    function handlePriceFilter() {
      const min = minPriceInput.value ? parseInt(minPriceInput.value) : null;
      const max = maxPriceInput.value ? parseInt(maxPriceInput.value) : null;
      if ((min !== null && min < 0) || (max !== null && max < 0)) { alert('Price cannot be negative'); return; }
      if (min !== null && max !== null && min > max) { alert('Minimum price cannot be greater than maximum price'); return; }
      activeFilters.minPrice = min; activeFilters.maxPrice = max; applyFilters(); updateFilterTags();
    }

    function applyFilters() {
      const allCards = Array.from(document.querySelectorAll('.product-card'));
      let visibleCount = 0;

      allCards.forEach(card => {
        const cardCat = getCardCategory(card);
        const cardPrice = getCardPrice(card);
        let show = true;

        if (activeFilters.categories.length > 0) {
          // If card category is unknown, assume it should be excluded unless filters are empty
          show = !!cardCat && activeFilters.categories.includes(cardCat);
        }

        if (show && activeFilters.minPrice !== null && cardPrice < activeFilters.minPrice) show = false;
        if (show && activeFilters.maxPrice !== null && cardPrice > activeFilters.maxPrice) show = false;

        card.style.display = show ? '' : 'none';
        if (show) visibleCount++;
      });

      updateProductCount(visibleCount);
      // After updating product visibility, hide/show the category headers
      updateCategoryHeaders();
    }

    // Hide or show .product-division sections (category headers) depending on whether
    // any visible product belongs to that category.
    function updateCategoryHeaders() {
      const divisions = document.querySelectorAll('.product-division');
      const productGrid = document.getElementById('productGrid');
      // helper to get category for a card element: prefer data-category, fall back to matching title
      function getCardCategory(cardEl) {
        const attr = (cardEl.getAttribute('data-category') || '').toLowerCase();
        if (attr) return attr;
        const title = cardEl.querySelector('.card-title')?.textContent.trim();
        if (!title) return null;
        const prod = products.find(p => p.name === title);
        return prod ? prod.category : null;
      }

      divisions.forEach(div => {
        const h2 = div.querySelector('h2');
        if (!h2) return;
        const headingText = h2.textContent.trim().toLowerCase();

        // Map heading text to category key used by products data.
        let categoryKey = null;
        if (headingText.includes('tea')) categoryKey = 'tea';
        else if (headingText.includes('spice')) categoryKey = 'spices';
        else if (headingText.includes('nut')) categoryKey = 'nuts';
        else if (headingText.includes('other') || headingText.includes('savour') || headingText.includes('savouries')) categoryKey = 'other';

        if (!categoryKey) { div.style.display = ''; return; }

        // Count visible product-card elements that match this category using robust category detection
        const visibleCards = Array.from(document.querySelectorAll('.product-card')).filter(el => {
          const cat = getCardCategory(el) || '';
          const isVisible = (el.style.display !== 'none');
          return isVisible && cat.toLowerCase() === categoryKey;
        });

        const visibleMatchCount = visibleCards.length;
        console.debug(`Category header '${headingText}' mapped->'${categoryKey}' visible matches:`, visibleMatchCount);

        if (visibleMatchCount > 0) {
          // Make sure the section is visible
          div.style.display = '';
          // Move the entire section so it appears directly before the first visible card of that category
          const firstCard = visibleCards[0];
          if (productGrid && firstCard && firstCard.parentNode === productGrid) {
            // Insert section before the first card
            productGrid.insertBefore(div, firstCard);
          } else if (productGrid && firstCard) {
            // If firstCard isn't a direct child of productGrid, find its nearest ancestor
            productGrid.insertBefore(div, firstCard);
          }
        } else {
          // No visible cards for this category — hide the section
          div.style.display = 'none';
        }
      });
    }

    function clearAllFilters() {
      categoryFilters.forEach(f => f.checked = false);
      minPriceInput.value = ''; maxPriceInput.value = '';
      activeFilters = { categories: [], minPrice: null, maxPrice: null };
      applyFilters(); updateFilterTags();
    }

    function handleSort() {
      if (!sortSelect) return;
      const sortValue = sortSelect.value;
      const productGrid = document.getElementById('productGrid');
      if (!productGrid) return;

      // get product-card elements that are actually visible in the layout
      let elems = Array.from(productGrid.querySelectorAll('.product-card')).filter(el => {
        const style = window.getComputedStyle(el);
        return style && style.display !== 'none' && style.visibility !== 'hidden' && el.offsetParent !== null;
      });

      console.debug('Sorting', { sortValue, visibleCount: elems.length });

      if (sortValue === 'default') {
        elems.sort((a,b) => (parseInt(a.getAttribute('data-original-order')||0) - parseInt(b.getAttribute('data-original-order')||0)));
      } else if (sortValue === 'price-low') {
        elems.sort((a,b) => (parseInt(a.getAttribute('data-price')||0) - parseInt(b.getAttribute('data-price')||0)));
      } else if (sortValue === 'price-high') {
        elems.sort((a,b) => (parseInt(b.getAttribute('data-price')||0) - parseInt(a.getAttribute('data-price')||0)));
      } else if (sortValue === 'name') {
        elems.sort((a,b) => a.querySelector('.card-title').textContent.localeCompare(b.querySelector('.card-title').textContent));
      }

      // Append in sorted order
      elems.forEach(el => productGrid.appendChild(el));
      // If a non-default sort is applied, hide all category headings so only products show.
      if (sortValue && sortValue !== 'default') {
        document.querySelectorAll('.product-division').forEach(div => div.style.display = 'none');
        console.debug('Sort active — hiding category headers');
      } else {
        // Recompute category headers after reordering (restore normal behavior)
        updateCategoryHeaders();
      }
    }

    function updateProductCount(visibleCount = null) {
      const totalCount = products.length;
      if (visibleCount === null) productCount.textContent = `Showing all ${totalCount} products`;
      else productCount.textContent = `Showing ${visibleCount} of ${totalCount} products`;
    }

    function updateFilterTags() {
      filterTags.innerHTML = '';
      activeFilters.categories.forEach(category => {
        const tag = document.createElement('span'); tag.className = 'filter-badge'; tag.textContent = category.charAt(0).toUpperCase()+category.slice(1);
        tag.style.cursor='pointer'; tag.addEventListener('click', ()=>{ const cb = document.querySelector(`.category-filter[value="${category}"]`); if(cb){cb.checked=false; handleCategoryFilter();}});
        filterTags.appendChild(tag);
      });
      if (activeFilters.minPrice !== null || activeFilters.maxPrice !== null) {
        const priceText = `₹${activeFilters.minPrice || '0'} - ₹${activeFilters.maxPrice || 'Any'}`;
        const tag = document.createElement('span'); tag.className='filter-badge'; tag.textContent=priceText; tag.style.cursor='pointer';
        tag.addEventListener('click', ()=>{ minPriceInput.value=''; maxPriceInput.value=''; handlePriceFilter(); });
        filterTags.appendChild(tag);
      }
      document.getElementById('activeFilters').style.display = (activeFilters.categories.length>0 || activeFilters.minPrice!==null || activeFilters.maxPrice!==null)?'block':'none';
    }
  });
</script>

<!-- Floating Cart Widget -->
<div id="cartWidget" aria-live="polite">
  <div id="cartToast" class="cart-toast" role="status" aria-atomic="true">
    <div id="cartToastMessage">Added to cart</div>
    <div class="d-flex align-items-center gap-2">
      <button id="openCartBtn" class="btn btn-sm btn-success">View</button>
      <button id="cartToastClose" class="btn btn-sm btn-outline-secondary">Close</button>
    </div>
  </div>

  <div id="cartPanel" class="cart-panel" aria-hidden="true">
    <div class="cart-header d-flex justify-content-between align-items-center">
      <strong>Your Cart</strong>
      <div>
        <button id="clearCartBtn" class="btn btn-sm btn-outline-secondary me-2">Clear</button>
        <button id="closeCartBtn" class="btn btn-sm btn-outline-dark">Close</button>
      </div>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer d-flex justify-content-between align-items-center">
      <div>
        <div class="small text-muted">Subtotal</div>
        <div id="cartSubtotal" class="fw-bold">₹0</div>
      </div>
      <div>
        <button id="checkoutBtn" class="btn btn-success">Checkout</button>
      </div>
    </div>
  </div>
</div>

<script src="scripts/cart.js"></script>

</body>
</html>
